(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{498:function(s,t,a){"use strict";a.r(t);var e=a(4),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch"}},[s._v("#")]),s._v(" Elasticsearch")]),s._v(" "),a("h3",{attrs:{id:"基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),a("p",[s._v("Elasticsearch 本质上是一个数据库，但并不是 MySQL 这种关系型数据库，查询语言也不是 SQL，而是 Elasticsearch 自己的一套查询语言。")]),s._v(" "),a("p",[s._v("既然是数据库，有一些概念是互通的，如下表：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[s._v("MySQL")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("Elasticsearch")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("表（Table）")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("索引（Index）")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("记录（Row）")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("文档（Document）")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("字段（Column）")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("字段（Fields）")])])])]),s._v(" "),a("h3",{attrs:{id:"docker安装es"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker安装es"}},[s._v("#")]),s._v(" docker安装es")]),s._v(" "),a("blockquote",[a("p",[s._v("这里以 es 7.7.0 为例 somenetwork 名称随意取")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ docker network create somenetwork\n$ docker run -d --name es --net somenetwork -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovery.type=single-node"')]),s._v(" elasticsearch:7.7.0\n")])])]),a("p",[s._v("测试是否安装成功")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:9200\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abb9d13686bd"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster_name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-cluster"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster_uuid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0Wnxm7uJTyGUrHlDE40fWA"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.7.0"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_flavor"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_hash"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"81a1e9eda8e6183f5237786246f6dced26a10eaf"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_date"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-05-12T02:01:37.602180Z"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_snapshot"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lucene_version"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8.5.1"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minimum_wire_compatibility_version"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.8.0"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minimum_index_compatibility_version"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.0.0-beta1"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tagline"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"You Know, for Search"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h3",{attrs:{id:"安装中文分词ik"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装中文分词ik"}},[s._v("#")]),s._v(" 安装中文分词ik")]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",[s._v("ik 的版本必须与es版本一致")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("//进入容器\n$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it es /bin/bash\n//安装插件\n$ elasticsearch-plugin "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip\n//退出容器并重启\n$ Ctrl+Q+P\n$ docker restart es\n\n")])])]),a("h3",{attrs:{id:"基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本使用"}},[s._v("#")]),s._v(" 基本使用")]),s._v(" "),a("ol",[a("li",[s._v("创建index")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPUT http://localhost:9200/test_index?pretty\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("创建map")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -H"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -XPUT http://localhost:9200/test_index/_mapping?pretty -d"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n"properties": {\n    "title": { "type": "text", "analyzer": "ik_max_word" }, \n    "description": { "type": "text", "analyzer": "ik_max_word" },\n    "price": { "type": "scaled_float", "scaling_factor": 100 }\n    }\n}\'')]),s._v("\n")])])]),a("p",[s._v("解析：")]),s._v(" "),a("ul",[a("li",[s._v("提交数据中的 properties 代表这个索引中各个字段的定义，其中 key 为字段名称，value 是字段的类型定义；")]),s._v(" "),a("li",[s._v("type 定义了字段的数据类型，常用的有 text / integer / date / boolean，当然还有许多类型，不一一列出。")]),s._v(" "),a("li",[s._v("analyzer 是一个新的概念，这是告诉 Elasticsearch 应该用什么方式去给这个字段做分词，这里我们用了 ik_max_word ik分词器提供")])]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("创建_doc")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -H"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -XPUT http://localhost:9200/test_index/_doc/1?pretty -d"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n    "title": "iPhone X",\n    "description": "新品到货",\n    "price": 8848\n}\'')]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -H"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -XPUT http://localhost:9200/test_index/_doc/2?pretty -d"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n    "title": "OPPO R15",\n    "description": "新品到货",\n    "price": 2000\n}\'')]),s._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("读取数据")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://localhost:9200/test_index/_doc/1?pretty\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("搜索")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/test_index/_search'")]),s._v(" //会返回所有记录\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[s._v("简单搜索")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPOST -H"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type:application/json'")]),s._v(" http://localhost:9200/test_index/_doc/_search?pretty -d"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n    "query" : { "match" : { "description" : "新" }}\n}\'')]),s._v("\n")])])]),a("ul",[a("li",[s._v("获取所有index")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/_cat/indices?v'")]),s._v("\n")])])]),a("ul",[a("li",[s._v("获取指定index的map")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/index/_mapping?pretty=true'")]),s._v("\n")])])]),a("ul",[a("li",[s._v("获取指定index的所有数据")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/index/_search'")]),s._v("\n")])])]),a("ul",[a("li",[s._v("获取指定index的单条数据")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/index/_doc/id'")]),s._v("\n")])])]),a("h3",{attrs:{id:"安装-elasticsearch-elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-elasticsearch-elasticsearch"}},[s._v("#")]),s._v(" 安装 elasticsearch/elasticsearch")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ composer require elasticsearch/elasticsearch "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'~7.0'")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("我们用的是 7.x，因此需使用 ~7.0 来指定包版本")])]),s._v(" "),a("p",[s._v("使用")]),s._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("require")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'vendor/autoload.php'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[s._v("Elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("ClientBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$client")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ClientBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),a("h2",{attrs:{id:"kibana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kibana"}},[s._v("#")]),s._v(" Kibana")]),s._v(" "),a("h3",{attrs:{id:"docker安装kibana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker安装kibana"}},[s._v("#")]),s._v(" docker安装kibana")]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",[s._v("kibana 的版本必须与es版本一致")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" //查出 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" 如:172.170.0.15\n$ docker run -d --name kibana --net somenetwork --ip "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.170")]),s._v(".0.15  -v /home/docker/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml  -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v(":5601 kibana:7.7.0\n")])])]),a("blockquote",[a("p",[s._v("这里的 --net somenetwork 需要与上面 docker network create somenetwork 这一步中的 somenetwork 取值一样")])]),s._v(" "),a("p",[s._v("浏览器中访问 x.x.x.x:5601 即可打开页面  x.x.x.x换成你虚拟机的局域网ip")])])}),[],!1,null,null,null);t.default=n.exports}}]);